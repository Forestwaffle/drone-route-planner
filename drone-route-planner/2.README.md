# 🚁 Drone Route Planner

여러 대의 드론을 이용해 배송 경로를 최적화하는 프로그램입니다.
Google OR-Tools를 이용하여 최적 경로를 탐색하고, Folium으로 지도에 경로를 시각화합니다.

---

## 📌 주요 기능

* **최적 경로 탐색**: OR-Tools를 사용해 드론의 운행 경로를 자동 최적화
* **운행 제약 반영**: 드론 용량, 최대 왕복 거리, 운행 횟수, 속도, 대기시간 고려
* **스케줄링**: 우선순위 큐를 이용해 가장 빨리 가용 가능한 드론부터 할당
* **시각화**: Folium을 사용해 결과 경로를 HTML 지도에 표시

---


## 🗂 코드 구조 
### 1. 설정값

드론 운행 관련 기본값을 정의합니다.

```python
DRONE_COUNT = 3       # 드론 수
DRONE_CAPACITY = 2    # 드론 1회 최대 배송 가능 지점 수
MAX_TRIPS = 3         # 드론 1대당 최대 운행 횟수
MAX_DISTANCE = 1.1    # 단일 왕복 최대 거리 (km)
SPEED = 40            # 드론 속도 (km/h)
WAIT_TIME = 0.5       # 왕복 후 대기시간 (분)
CSV_FILE = "places.csv" # 입력 데이터 파일
```

---

### 2. 거리 계산 (Haversine)

위경도 좌표 두 점 사이의 구면 거리를 km 단위로 계산합니다.

```python
def haversine(lat1, lon1, lat2, lon2): ...
```

---

### 3. CSV 로드

`places.csv`에서 위치와 장소명을 읽어옵니다.

```python
def load_locations(file_name): ...
# 반환: (locations, names)
```

---

### 4. 거리 행렬 생성

모든 지점 간 거리를 2차원 대칭 행렬로 생성합니다.

```python
def build_distance_matrix(locations): ...
# 반환: distances[i][j] = 거리(km)
```

---

### 5. OR-Tools 최적 경로 탐색

특정 지점 집합을 한 번의 운행으로 방문할 최적 경로를 찾습니다.

```python
def find_best_route(subset, distances): ...
# 반환: (route, total_km)
```

---

### 6. 드론 경로 계획

우선순위 큐 기반 스케줄링으로 드론별 운행 계획을 생성합니다.

* 일반 배달: 가까운 지점들을 용량 단위로 묶음 배달
* 장거리 배달: 남은 지점을 먼 순서대로 단독 왕복 배달

```python
def plan_drone_routes(locations, names, distances): ...
# 반환: drone_routes (드론별 운행 기록)
```

---

### 7. 결과 출력

드론별 운행 내역과 구간별 거리·시간을 콘솔에 출력합니다.

```python
def print_results(drone_routes, names, distances): ...
```

---

### 8. 지도 생성 (Folium)

드론별 운행 경로를 색상별로 시각화하여 HTML 파일로 저장합니다.

```python
def create_map(locations, names, drone_routes, out_html="tsp_map.html"): ...
# 출력: tsp_map.html
```

---

### 9. 메인 실행

전체 흐름을 실행합니다.

```python
def main():
    locations, names = load_locations(CSV_FILE)
    distances = build_distance_matrix(locations)
    drone_routes = plan_drone_routes(locations, names, distances)
    print_results(drone_routes, names, distances)
    create_map(locations, names, drone_routes)

if __name__ == "__main__":
    main()
```

---

## 📊 실행 예시 (콘솔 출력)

```
드론 1
  운행 1: 본부 -> A -> B -> 본부, 거리 1.05 km, 시간 1.6분
    본부 → A: 0.52 km
    A → B: 0.30 km
    B → 본부: 0.23 km
총 거리: 1.05 km, 총 시간: 1.6분
```

---

## 🌍 결과 지도

* 실행 후 `tsp_map.html` 파일이 생성됩니다.
* 웹 브라우저에서 열어 드론 경로를 시각적으로 확인할 수 있습니다.

---

## 📌 참고

* OR-Tools: [https://developers.google.com/optimization](https://developers.google.com/optimization)
* Folium: [https://python-visualization.github.io/folium](https://python-visualization.github.io/folium)
* Drone Route Planner 코드 분석: https://www.notion.so/Drone-Route-Planner-27b781c9f73d80498b39dec8eca571f1?source=copy_link

